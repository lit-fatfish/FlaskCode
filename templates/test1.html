<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>后台管理系统</title>

    <script type="text/javascript" src="/static/axios.min.js"></script>
    <script type="text/javascript" src="/static/vue.min.js"></script>
    <link rel="stylesheet" href="/static/bootstrap-3.3.7/css/bootstrap.min.css">
    <script type="text/javascript" src="/static/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="/static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
{% raw %}


    <div id="app">
        <button class="btn btn-primary" @click="test" type="button">显示状态</button>
        <!-- <div style="height: 150px">{{ todos }}</div> -->
            <table v-if="seen" class="table table-striped table-bordered" >
                <tr>
                    <th>开始时间</th>
                    <th>完整路径</th>
                    <th>上传地址</th>
                    <th>文件名</th>
                    <th>摄像头ID</th>
                    <th>回调地址</th>
                    <th>失败次数</th>
                </tr>
                <tr v-for="todo in todos">
                    <td>{{ todo.time_start }}</td>
                    <td>{{ todo.filename }}</td>
                    <td>{{ todo.url }}</td>
                    <td>{{ todo.data_id }}</td>
                    <td>{{ todo.cameracode }}</td>
                    <td>{{ todo.resultAddress }}</td>
                    <td>{{ todo.fail_num }}</td>

                </tr>
            </table>
            <table v-if="seen_status" class="table table-striped table-bordered" >
                <tr>
                    <th>序号</th>
                    <th>视频地址</th>
                    <th>状态</th>
                    <th>失败次数</th>
                    <th>失败次数</th>

                </tr>
                <tr v-for="todo in todos">
                    <td>{{ todo.num }}</td>
                    <td>{{ todo.rtmp_url }}</td>
                    <td>{{ todo.status }}</td>
                    <td>{{ todo.fail_num }}</td>
                    <td><a href="111">1111</a></td>


                </tr>
            </table>
    </div>
{% endraw %}
    <script>
        new Vue({
            el: '#app',
            data: function () {
                return {
                    //visible: false,
                    seen:true,
                    seen_status:false,
                    todos: [
                            {
                                "data_id": "",
                                "fail_num": 0,
                                "filename": "",
                                "resultAddress": "",
                                "time_start": "",
                                "url": ""
                            },
                            {
                                "fail_num":"",
                                "num":0,
                                "rtmp_url":"",
                                "status":""
                            }
                        /*
                            {
                                "id": "a63f7686bda145978dfa5114dd53525b",
                                "fail_num": 0,
                                "filename": ".\\video\\2020-07-20\\a63f7686bda145978dfa5114dd53525b.mp4",
                                "resultAddress": "https://power.anlly.net/customer/api/v1/callback",
                                "time_start": "2020-07-20 16:47:03",
                                "url": "http://192.168.31.83/gd/Handle.php"
                            }
*/
                    ]
                }
            },

            mounted() {
                // 进入页面自动调用此函数
                const self = this
                axios.post("/info").then((data) => {
                    console.log("data: ", data)
                    self.todos = data.data
                    self.seen = true
                    self.seen_status = false
                    console.log("data: ", data.data[0])
                })
                .catch((err) => {
                    console.log("err: ", err)
                })
            },
            methods: {
                test: function () {
                    const self = this
                    axios.post("http://127.0.0.1:5000/status").then((data) => {
                        console.log("data: ", data)
                        self.todos = data.data
                        self.seen = false
                        self.seen_status = true
                    })
                    .catch((err) => {
                        console.log("err: ", err)
                    })
                }
            }
        })
        {#console.log('axios: ', axios)#}

    </script>
</body>
</html>